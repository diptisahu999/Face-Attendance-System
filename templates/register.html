<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Employee Upload</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-lg">
    <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Upload Employee Images</h2>
    
    <form id="uploadForm" class="space-y-5">
      <!-- Employee Name -->
      <div>
        <label class="block mb-2 text-gray-700 font-medium">Employee Name</label>
        <input type="text" id="name" name="name" 
          class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" 
          placeholder="Enter employee name" required>
      </div>

      <!-- Employee ID -->
      <div>
        <label class="block mb-2 text-gray-700 font-medium">Employee ID</label>
        <input type="text" id="id" name="id" 
          class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" 
          placeholder="Enter employee ID" required>
      </div>

      <!-- Member Code -->
      <div>
        <label class="block mb-2 text-gray-700 font-medium">Member Code</label>
        <input type="text" id="member_code" name="member_code" 
          class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" 
          placeholder="Enter member code" required>
      </div>

      <!-- Upload Images -->
      <div>
        <label class="block mb-2 text-gray-700 font-medium">Upload Pictures</label>
        <input type="file" id="pictures" name="pictures" multiple accept="image/*"
          class="w-full px-4 py-2 border rounded-lg cursor-pointer bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none">
        
        <!-- Preview Section -->
        <div id="preview" class="mt-4 grid grid-cols-3 gap-3"></div>
      </div>

      <!-- Submit Button -->
      <button type="submit" 
        class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg shadow hover:bg-blue-700 transition">
        Upload
      </button>
    </form>

    <!-- Response Message -->
    <div id="responseMessage" class="mt-6 text-center font-medium"></div>
  </div>

  <script>
    const form = document.getElementById("uploadForm");
    const preview = document.getElementById("preview");
    const responseMessage = document.getElementById("responseMessage");

    // Image Preview
    document.getElementById("pictures").addEventListener("change", function () {
      preview.innerHTML = "";
      [...this.files].forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = document.createElement("img");
          img.src = e.target.result;
          img.className = "w-full h-24 object-cover rounded shadow";
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });

    // Submit Form
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData();
      formData.append("name", document.getElementById("name").value);
      formData.append("id", document.getElementById("id").value);
      formData.append("member_code", document.getElementById("member_code").value);

      const files = document.getElementById("pictures").files;
      for (let i = 0; i < files.length; i++) {
        formData.append("pictures", files[i]);
      }

      try {
        const res = await fetch("/upload", {  // ðŸ‘ˆ same FastAPI upload endpoint
          method: "POST",
          body: formData
        });

        const data = await res.json();
        if (res.ok) {
          responseMessage.className = "mt-6 text-green-600 font-medium";
          responseMessage.textContent = data.message || "Upload successful!";
        } else {
          responseMessage.className = "mt-6 text-red-600 font-medium";
          responseMessage.textContent = data.detail || "Upload failed!";
        }
      } catch (err) {
        responseMessage.className = "mt-6 text-red-600 font-medium";
        responseMessage.textContent = "Error connecting to server.";
      }
    });
  </script>
</body>
</html>
